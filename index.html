<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Shop</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#f5f5f5;color:#333}
header{background:#2c3e50;color:white;padding:15px 20px}
.header{display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.5rem;font-weight:bold}
.user-info{display:flex;gap:15px;align-items:center}
.balance{background:#34495e;padding:5px 15px;border-radius:20px}
.btn{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-weight:bold}
.btn-primary{background:#3498db;color:white}
.btn-secondary{background:#e74c3c;color:white}
.btn-outline{background:transparent;border:2px solid #3498db;color:#3498db}
.container{max-width:1200px;margin:0 auto;padding:20px}
.categories{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.category-btn{padding:8px 16px;background:white;border:none;border-radius:4px;cursor:pointer}
.category-btn.active{background:#3498db;color:white}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}
.product-card{background:white;border-radius:5px;overflow:hidden;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.product-img{height:150px;background:#ecf0f1;display:flex;align-items:center;justify-content:center}
.product-info{padding:15px}
.product-price{font-size:1.2rem;font-weight:bold;color:#2c3e50;margin:10px 0}
.product-stock{color:#27ae60;font-size:0.9rem}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:white;border-radius:5px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto}
.modal-header{padding:15px;border-bottom:1px solid #eee;display:flex;justify-content:space-between}
.modal-body{padding:15px}
.form-group{margin-bottom:15px}
.form-control{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}
.admin-panel{background:white;padding:20px;border-radius:5px;margin-top:20px;display:none}
.admin-panel.active{display:block}
.tabs{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.tab{padding:8px 16px;background:#ecf0f1;border:none;border-radius:4px;cursor:pointer}
.tab.active{background:#3498db;color:white}
.tab-content{display:none}
.tab-content.active{display:block}
.order-card{background:#f8f9fa;border:1px solid #dee2e6;border-radius:5px;padding:15px;margin-bottom:10px}
.hidden{display:none!important}
.mt-20{margin-top:20px}
</style>
</head>
<body>
<header>
<div class="container">
<div class="header">
<div class="logo">SHOP</div>
<div class="user-info">
<div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span>‚Ç¥</div>
<button class="btn btn-outline" onclick="showTab('auth')" id="authBtn">–í–æ–π—Ç–∏</button>
<button class="btn btn-secondary hidden" onclick="logout()" id="logoutBtn">–í—ã–π—Ç–∏</button>
<button class="btn btn-primary" onclick="toggleAdmin()">–ê–¥–º–∏–Ω–∫–∞</button>
</div>
</div>
</div>
</header>

<div class="container">
<div id="authTab" class="tab-content active">
<div class="form-group">
<input type="text" class="form-control" id="authUser" placeholder="–ò–º—è" value="user1">
</div>
<div class="form-group">
<input type="password" class="form-control" id="authPass" placeholder="–ü–∞—Ä–æ–ª—å" value="pass1">
</div>
<button class="btn btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
<button class="btn btn-secondary" onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>

<div id="productsTab" class="tab-content hidden">
<div class="categories">
<button class="category-btn active" onclick="selectCategory('all')">–í—Å–µ</button>
<div id="categoryList"></div>
</div>
<div class="products-grid" id="productsGrid"></div>
</div>

<div id="ordersTab" class="tab-content hidden">
<h3>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3>
<div id="myOrders"></div>
</div>

<div class="admin-panel" id="adminPanel">
<div class="tabs">
<button class="tab active" onclick="switchAdminTab('adminOrders')">–ó–∞–∫–∞–∑—ã</button>
<button class="tab" onclick="switchAdminTab('adminProducts')">–¢–æ–≤–∞—Ä—ã</button>
<button class="tab" onclick="switchAdminTab('adminUsers')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
<button class="tab" onclick="switchAdminTab('adminSettings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<div id="adminOrders" class="tab-content active">
<div id="allOrders"></div>
</div>

<div id="adminProducts" class="tab-content">
<div class="form-group">
<select class="form-control" id="productCategory">
<option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
</select>
</div>
<div class="form-group">
<input type="text" class="form-control" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
</div>
<div class="form-group">
<input type="number" class="form-control" id="productPrice" placeholder="–¶–µ–Ω–∞">
</div>
<div class="form-group">
<input type="number" class="form-control" id="productStock" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
</div>
<button class="btn btn-primary" onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button class="btn btn-secondary" onclick="deleteProduct()">–£–¥–∞–ª–∏—Ç—å</button>
</div>

<div id="adminUsers" class="tab-content">
<div class="form-group">
<input type="text" class="form-control" id="searchUser" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
</div>
<div class="form-group">
<input type="number" class="form-control" id="addBalance" placeholder="–°—É–º–º–∞">
</div>
<button class="btn btn-primary" onclick="changeBalance()">–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
</div>

<div id="adminSettings" class="tab-content">
<div class="form-group">
<label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:</label>
<input type="password" class="form-control" id="newAdminPass">
</div>
<button class="btn btn-primary" onclick="changeAdminPass()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
</div>
</div>
</div>

<div class="modal" id="productModal">
<div class="modal-content">
<div class="modal-header">
<h3 id="modalTitle"></h3>
<button onclick="closeModal()">&times;</button>
</div>
<div class="modal-body">
<div class="product-price" id="modalPrice"></div>
<p id="modalDesc"></p>
<p id="modalStock"></p>
<button class="btn btn-primary mt-20" onclick="buyProduct()">–ö—É–ø–∏—Ç—å</button>
</div>
</div>
</div>

<script>
let storeData = {users:{},categories:{},orders:[],adminPass:"log21"};
let currentUser = null;
let currentProduct = null;
let selectedCategory = 'all';
let isAdmin = false;

async function loadData(){
const res = await fetch('/get_data');
storeData = await res.json();
if(!storeData.adminPass) storeData.adminPass="log21";
updateUI();
}

async function saveData(){
await fetch('/save_data',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify(storeData)
});
}

function updateUI(){
updateCategories();
updateProducts();
updateBalance();
if(currentUser) updateOrders();
if(isAdmin) updateAdminOrders();
}

function updateCategories(){
const list = document.getElementById('categoryList');
list.innerHTML='';
for(let cat in storeData.categories){
const btn = document.createElement('button');
btn.className='category-btn';
btn.textContent=cat;
btn.onclick=()=>selectCategory(cat);
list.appendChild(btn);
}
const select = document.getElementById('productCategory');
select.innerHTML='<option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>';
for(let cat in storeData.categories){
const option = document.createElement('option');
option.value=cat;
option.textContent=cat;
select.appendChild(option);
}
}

function updateProducts(){
const grid = document.getElementById('productsGrid');
grid.innerHTML='';
let products=[];
if(selectedCategory==='all'){
for(let cat in storeData.categories){
for(let prod in storeData.categories[cat]){
products.push({category:cat,name:prod,...storeData.categories[cat][prod]});
}}
}else{
const cat=storeData.categories[selectedCategory];
if(cat){
for(let prod in cat){
products.push({category:selectedCategory,name:prod,...cat[prod]});
}}}
if(products.length===0){
grid.innerHTML='<p>–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</p>';
return;
}
products.forEach(p=>{
const card = document.createElement('div');
card.className='product-card';
card.innerHTML=`
<div class="product-img">üì¶</div>
<div class="product-info">
<h4>${p.name}</h4>
<div class="product-price">${p.price}‚Ç¥</div>
<p class="product-stock">–í –Ω–∞–ª–∏—á–∏–∏: ${p.stock}</p>
<button class="btn btn-primary" onclick="showProduct('${p.category}','${p.name}')">
–ü–æ–¥—Ä–æ–±–Ω–µ–µ
</button>
</div>`;
grid.appendChild(card);
});
}

function updateBalance(){
const balanceEl = document.getElementById('balance');
const authBtn = document.getElementById('authBtn');
const logoutBtn = document.getElementById('logoutBtn');
if(currentUser && storeData.users[currentUser]){
balanceEl.textContent=storeData.users[currentUser].balance;
authBtn.textContent=currentUser;
authBtn.classList.add('hidden');
logoutBtn.classList.remove('hidden');
}else{
balanceEl.textContent='0';
authBtn.textContent='–í–æ–π—Ç–∏';
authBtn.classList.remove('hidden');
logoutBtn.classList.add('hidden');
}
}

function updateOrders(){
const div = document.getElementById('myOrders');
div.innerHTML='';
if(!currentUser) return;
const userOrders = storeData.orders.filter(o=>o.user===currentUser);
if(userOrders.length===0){
div.innerHTML='<p>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
return;
}
userOrders.forEach(o=>{
const card = document.createElement('div');
card.className='order-card';
card.innerHTML=`
<p><strong>${o.product}</strong> - ${o.price}‚Ç¥</p>
<p>–°—Ç–∞—Ç—É—Å: ${o.status||'–æ–∂–∏–¥–∞–µ—Ç'}</p>
${(o.status||'–æ–∂–∏–¥–∞–µ—Ç')==='–æ–∂–∏–¥–∞–µ—Ç'?`
<button class="btn btn-secondary" onclick="cancelOrder('${o.id}')">
–û—Ç–º–µ–Ω–∏—Ç—å
</button>`:''}
`;
div.appendChild(card);
});
}

function updateAdminOrders(){
const div = document.getElementById('allOrders');
div.innerHTML='';
if(!storeData.orders||storeData.orders.length===0){
div.innerHTML='<p>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</p>';
return;
}
storeData.orders.forEach((o,i)=>{
const card = document.createElement('div');
card.className='order-card';
card.innerHTML=`
<p><strong>${o.user}</strong>: ${o.product} - ${o.price}‚Ç¥</p>
<p>–°—Ç–∞—Ç—É—Å: ${o.status||'–æ–∂–∏–¥–∞–µ—Ç'}</p>
<button class="btn" onclick="changeOrderStatus('${o.id}','–≤—ã–ø–æ–ª–Ω–µ–Ω')">
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω
</button>
<button class="btn" onclick="changeOrderStatus('${o.id}','–æ—Ç–º–µ–Ω–µ–Ω')">
‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
</button>
`;
div.appendChild(card);
});
}

function showTab(tab){
document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
document.getElementById(tab+'Tab').classList.remove('hidden');
if(tab==='orders') updateOrders();
}

function login(){
const user=document.getElementById('authUser').value;
const pass=document.getElementById('authPass').value;
if(user==='admin'&&pass===storeData.adminPass){
currentUser='admin';isAdmin=true;
showTab('products');updateUI();
return;
}
if(storeData.users[user]&&storeData.users[user].password===pass){
currentUser=user;isAdmin=false;
showTab('products');updateUI();
}else alert('–ù–µ–≤–µ—Ä–Ω–æ');
}

function register(){
const user=document.getElementById('authUser').value;
const pass=document.getElementById('authPass').value;
if(!storeData.users[user]){
storeData.users[user]={balance:1000,password:pass};
currentUser=user;
saveData();
showTab('products');updateUI();
alert('–£—Å–ø–µ—à–Ω–æ');
}else alert('–£–∂–µ –µ—Å—Ç—å');
}

function logout(){
currentUser=null;isAdmin=false;
showTab('auth');updateUI();
}

function selectCategory(cat){
selectedCategory=cat;
document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
updateProducts();
}

function showProduct(cat,name){
currentProduct={cat,name};
const p=storeData.categories[cat][name];
document.getElementById('modalTitle').textContent=name;
document.getElementById('modalPrice').textContent=p.price+'‚Ç¥';
document.getElementById('modalDesc').textContent=p.description||'–û–ø–∏—Å–∞–Ω–∏—è –Ω–µ—Ç';
document.getElementById('modalStock').textContent='–í –Ω–∞–ª–∏—á–∏–∏: '+p.stock;
document.getElementById('productModal').classList.add('active');
}

function closeModal(){
document.getElementById('productModal').classList.remove('active');
}

async function buyProduct(){
if(!currentUser){alert('–í–æ–π–¥–∏—Ç–µ');return;}
const {cat,name}=currentProduct;
const p=storeData.categories[cat][name];
const u=storeData.users[currentUser];
if(u.balance>=p.price&&p.stock>0){
u.balance-=p.price;
p.stock--;
const order={
id:Date.now().toString(),
user:currentUser,
product:name,
category:cat,
price:p.price,
status:'–æ–∂–∏–¥–∞–µ—Ç',
createdAt:new Date().toISOString()
};
storeData.orders.push(order);
await saveData();
updateUI();
closeModal();
alert('–ö—É–ø–ª–µ–Ω–æ');
}else alert('–ù–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å');
}

async function cancelOrder(id){
const o=storeData.orders.find(x=>x.id===id);
if(o&&o.user===currentUser&&(o.status||'–æ–∂–∏–¥–∞–µ—Ç')==='–æ–∂–∏–¥–∞–µ—Ç'){
o.status='–æ—Ç–º–µ–Ω–µ–Ω';
const u=storeData.users[currentUser];
if(u) u.balance+=o.price;
if(storeData.categories[o.category]&&storeData.categories[o.category][o.product]){
storeData.categories[o.category][o.product].stock++;
}
await saveData();
updateUI();
}
}

function toggleAdmin(){
if(!isAdmin){
const pass=prompt('–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:');
if(pass===storeData.adminPass){
isAdmin=true;
document.getElementById('adminPanel').classList.add('active');
updateAdminOrders();
}else alert('–ù–µ–≤–µ—Ä–Ω–æ');
}else{
document.getElementById('adminPanel').classList.toggle('active');
}
}

function switchAdminTab(tab){
document.querySelectorAll('#adminPanel .tab-content').forEach(t=>t.classList.add('hidden'));
document.querySelectorAll('#adminPanel .tab').forEach(t=>t.classList.remove('active'));
document.getElementById(tab).classList.remove('hidden');
event.target.classList.add('active');
}

async function changeOrderStatus(id,status){
const o=storeData.orders.find(x=>x.id===id);
if(o){
const old=o.status||'–æ–∂–∏–¥–∞–µ—Ç';
o.status=status;
if(old==='–æ–∂–∏–¥–∞–µ—Ç'&&status==='–æ—Ç–º–µ–Ω–µ–Ω'){
const u=storeData.users[o.user];
if(u)u.balance+=o.price;
if(storeData.categories[o.category]&&storeData.categories[o.category][o.product]){
storeData.categories[o.category][o.product].stock++;
}}
await saveData();
updateAdminOrders();
}
}

async function saveProduct(){
const cat=document.getElementById('productCategory').value;
const name=document.getElementById('productName').value;
const price=parseFloat(document.getElementById('productPrice').value);
const stock=parseInt(document.getElementById('productStock').value);
if(cat&&name&&price&&stock){
if(!storeData.categories[cat]) storeData.categories[cat]={};
storeData.categories[cat][name]={price,stock};
await saveData();
updateUI();
alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
}
}

async function deleteProduct(){
const cat=document.getElementById('productCategory').value;
const name=document.getElementById('productName').value;
if(storeData.categories[cat]&&storeData.categories[cat][name]){
delete storeData.categories[cat][name];
await saveData();
updateUI();
alert('–£–¥–∞–ª–µ–Ω–æ');
}
}

async function changeBalance(){
const user=document.getElementById('searchUser').value;
const amount=parseFloat(document.getElementById('addBalance').value);
if(storeData.users[user]&&!isNaN(amount)){
storeData.users[user].balance+=amount;
await saveData();
alert('–ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω');
}
}

async function changeAdminPass(){
const pass=document.getElementById('newAdminPass').value;
if(pass){
storeData.adminPass=pass;
await saveData();
alert('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω');
}
}

loadData();
</script>
</body>
</html>
